{% extends "base.html" %}
{% block title %} Lista de categorias {% endblock %}
{% block content %}

<div class="container-fluid" style="min-height:100dvh;padding-top:100px">
<div class="table-responsive w-100 card myTheme-900 larg-max m-auto" style="padding-bottom: 80px">

<table class="table table-dropdown table-borderless table-sm myTheme-900 ">
<thead>
    <tr>
        <p class="h4 p-3 ">Lista de categorias</p>
    </tr>
    <tr>
        <th>
            <div class="d-flex">
                <a href="" class="p-2 btn btn-sm btn-floating btn-add"
                data-mdb-toggle="modal"
                data-mdb-target="#modal-categoria">
                <i class="fa-solid fa-plus"></i></a>
                <span class="h3 ms-2">Categorias</span>                            
            </div>
        </th>
    </tr>
</thead>

<tbody id="tb-categorias">
    {% for cat in categorias %}
    <tr>
        <td class="text-nowrap" scope="row"> 
        <details
        data-detailsId="{{ cat.id }}"
        
        >
        <summary class="ps-4">&nbsp;&nbsp;&nbsp;&nbsp;{{ cat.nome }}</summary>
        <table  class="mt-2 table-sm w-100 table-responsive myTheme-900">
            <tbody>
                {% for tam in tamanhos %}
                {% if tam.cat_id == cat.id %}
                <tr>
                    <div class="input-group mt-3 mb-3">
                        <button class="form-control-sm my-btn " type="button"
                        onclick="revomeTamanho( {{ tam.id }} , {{ cat.id }})">
                        <i class="fa-regular fa-trash-can fa-lg isdanger"></i>
                        </button>
                                <input
                                type="text"
                                class="form-control-sm myInputs"
                                style="min-width: 150px; text-transform: uppercase;"
                                value="{{ tam.nome }}"
                                />
                        <button class="form-control-sm my-btn" type="button">
                        <i class="fa-regular fa-pen-to-square fa-lg"></i>
                        </button>
                    </div>
                </tr>
                {% endif %}
                {% endfor %}                      
                <tr> 
                        <div class="input-group mt-4">
                        <input
                        data-catId="{{ cat.id }}"
                        type="text"
                        class="form-control-sm myInputs"
                        placeholder="Novo tamanho ..."
                        style="min-width: 150px;"
                        />
                            <button
                            class="btn form-control-sm btn-table-cadastrar" 
                            type="button"
                            onclick="addTamanho( {{ cat.id }} )">
                            NOVO
                            </button>
                        </div>
                        </tr>                                                    
            </tbody>   
                                           
            </table>
            </details>

            </td>
        </tr>
        {% endfor %}
</tbody>
</table>


</div>
</div>




<!-- *********************************************************** -->
<!-- MODAL -->
<!-- *********************************************************** -->
<div class="modal top fade pb-5" id="modal-categoria" aria-hidden="true"
  data-mdb-backdrop="true" data-mdb-keyboard="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content modal-cat">
      <div class="modal-header border-0">
        <h5 class="modal-title h3 " id="exampleModalLabel">Categorias</h5>
      </div>
      <div class="modal-body mb-0">  
    <form >
    <table  class="mt-2 table-sm w-100 table-responsive myTheme-900">
        <tbody>
            {% for cat in categorias %}
            <tr>
                    <div class="input-group mt-3 mb-3">
                    <button class="form-control-sm my-btn " type="button"                                        
                    onclick="revomeCategoria( {{ cat.id }} )" 
                    >
                    <i class="fa-regular fa-trash-can fa-lg isdanger"></i>
                    </button>
                    
                    <input
                    style="text-transform: uppercase;"
                    id="inputCat"
                    type="text"
                    class="form-control-sm myInputs"
                    style="min-width: 150px;"
                    value="{{ cat.nome }}"
                    data-id="{{ cat.id }}"
                    />
                    <button class="form-control-sm my-btn" type="button"
                    onclick="updateCategoria( {{ cat.id }} )" >
                    <i class="fa-regular fa-pen-to-square fa-lg"></i>
                    </button>
                    </div>
            </tr>
            {% endfor %}                      
            <tr>   
                <div class="input-group">
                <input
                id="inputNewCat"
                type="text"
                class="form-control-sm myInputs"
                placeholder="Nova categoria ..."
                style="min-width: 150px;text-transform: uppercase;"
                />
                    <button class="btn form-control-sm btn-table-cadastrar" type="button"
                    onclick="addCategoria()"
                    data-mdb-dismiss="modal">
                    NOVO
                    </button>
                </div>
            </tr>                                                    
        </tbody>                                                         
    </table>
    </form>
<a style="width:125px" 
type="button"
class="float-end btn btn-outline-primary m-1"
data-mdb-dismiss="modal">CANCELAR</a>

</div>
</div>
</div>
</div>
<!-- *********************************************************** -->
<!-- MODAL -->
<!-- *********************************************************** -->
<script type="text/javascript">


// **************************************************************************** 
function addCategoria() {
    let catValueNew = document.querySelector('#inputNewCat').value;
    fetch("/categorias_cadastrar/" + catValueNew)
    .then( (response) => { 
        location.reload();
    });
}
function revomeCategoria(id) {
        fetch("/categorias_deletar/" + id)
        .then( (response) => {
            location.reload();
        });
};
function updateCategoria(id) {    
        let valor = document.querySelector('[data-id="' + id + '"]').value;
        fetch("/categorias_atualizar/" + id + "/" + valor)
        .then( (response) => {
            location.reload();
        });
};
// ****************************************************************************
// tamanos_cadastrar
function addTamanho(catId) {
    let tamValueNew = document.querySelector('[data-catId="' + catId + '"]').value;
    fetch("/tamanos_cadastrar/" + catId + "/" + tamValueNew)
    .then( (response) => { 
        location.reload();       
    });
}
function revomeTamanho(id, catId) {   
    fetch("/tamanos_deletar/" + id)
    .then( (response) => {
        location.reload();
    })    
}


// alert('')
// catId = {{ catId }}
// document.querySelector('[data-detailsId="' + catId + '"]').open = true;

  


</script>

{% endblock %}



{% block titlefooter %}
<span>
    <i class="fa-regular fa-user fa-sm"></i>
    &nbsp;{{ user.first_name.split()[0] | upper }}
    &nbsp;&nbsp;&nbsp;
    <span>
        <i class="fa-regular fa-calendar fa-sm"> </i>
        &nbsp;{{ data.strftime('%d/%m/%Y') }}
    </span>
{% endblock %}